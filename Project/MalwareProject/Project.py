from virustotal import virustotal
import time

class Project:
    def __init__(self, dirName, vtToken):
        self.dirName = dirName
        self.vtToken = vtToken
        self.count=0
    def processAllFiles(self):
        allfiles=self.getAlreadyDonwloadedList()

        for file in allfiles:
            if self.count == 4:
                print("\nJSON object responses and it is limited to at most 4 requests! Wait a minute\n")
                time.sleep(60)  # Delay for 1 minute (60 seconds).
                self.count = 0
            else:
                print("file: "+file[1:])
                jsonFile=virustotal.getVirustotalReport(file[1:], self.vtToken)
                print("json: " + str(jsonFile))
                post_id = virustotal.save_responseinMongo(jsonFile)
                self.count = self.count + 1

    def getAlreadyDonwloadedList(self):
        with open('./downloadedList.txt') as f:
            list = f.read().splitlines()
        return list


project=Project("./exevirus", "5f53a02c561408cf58fca610f7998cafb7da61c0787771f05520346ac4abc002")
#jsonFile=virustotal.getVirustotalReport("./exevirus/tudosobrepalavras.com-wp-content-themes-islemag-img-sserv.jpg", project.vtToken)
#post_id = virustotal.save_responseinMongo(jsonFile)
project.processAllFiles()
