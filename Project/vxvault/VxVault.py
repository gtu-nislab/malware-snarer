
import urllib.request

#from ./virustotal import virustotal


#  "http://vxvault.net/URL_List.php" sitesindeki tum dosyalari indirir.


class VxVault:
    def __init__(self, urlPath,dirName):
        self.urlPath = urlPath
        self.allUrlLists =""
        self.dirName=dirName
        self.alreadyDownloadedList=""
    # dosya indirme fonksiyonu. url= indirilecegi dosya, fileName=kaydedilecek isim
    def download(self, link,  filename):
        isdonwloaded= self.isAlreadyDownloaded(filename)
        if isdonwloaded == -1:
            print("Is already downloaded -> " + link)
        else:
            try:
                urllib.request.urlretrieve(link, filename)
                with open("../downloadedList.txt", "a") as myfile:
                    myfile.write(filename)
                print("Successfully downloaded -> " + link)
            except:
                print("Error link -> " + link)
    # sitedeki tum listeyi ceker, http:// ile baslayanlari yeni listeye ekler
    def getAllLinks(self):
        with urllib.request.urlopen(self.urlPath) as response:
            data = response.read()
        print("\nGetting all links\n")
        httpString = "http"
        self.allUrlLists = list()
        allData = data.decode('utf8').split('\n')

        for link in allData:
            if httpString in link:
                link.replace("\n", "")
                self.allUrlLists.append(link)

    def printUrlLists(self):
        for link in self.allUrlLists:
            print(link)


    # listedeki tum dosyalari indirir    
    def downloadAllFiles(self):
        self.getAllLinks()
        self.printUrlLists()
        self.alreadyDownloadedList=self.getAlreadyDonwloadedList()
        print("\nDownloading files\n")
        for url in self.allUrlLists:
            file = self.dirName + "/" + url[7:len(url)].replace("/", "-")
            self.download(url, file)

    def getAlreadyDonwloadedList(self):
        with open('../downloadedList.txt') as f:
            list = f.read().splitlines()
        return list

    def isAlreadyDownloaded(self, link):

        if link[:len(link)-1] in self.alreadyDownloadedList:
            return -1
        else:
            return 0

vxVault = VxVault("http://vxvault.net/URL_List.php", "../exevirus")
vxVault.downloadAllFiles()

